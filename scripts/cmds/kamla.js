const fs = require("fs");
const path = __dirname + "/cache/kamlaOn.json";

module.exports = {
  config: {
    name: "kamla",
    version: "1.0",
    author: "rishi",
    description: "Tag someone to kamla-mode and insult them automatically when they chat",
    commandCategory: "fun",
    usages: "[on/off @tag]",
    cooldowns: 5,
  },

  onStart: async function({ api, event, args }) {
    const { threadID, messageID, mentions } = event;

    if (!fs.existsSync(path)) fs.writeFileSync(path, "[]", "utf-8");
    let kamlaList;
    try {
      kamlaList = JSON.parse(fs.readFileSync(path, "utf-8"));
    } catch {
      kamlaList = [];
    }

    if (args.length === 0) {
      return api.sendMessage(
        `âš ï¸ Usage:\n.kamla on @user - à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡ à¦šà¦¾à¦²à§ à¦•à¦°à¦¬à§‡\n.kamla off - à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡ à¦¬à¦¨à§à¦§ à¦•à¦°à¦¬à§‡`,
        threadID,
        messageID
      );
    }

    const command = args[0].toLowerCase();

    if (command === "off") {
      const updatedList = kamlaList.filter(e => e.threadID !== threadID);

      fs.writeFileSync(path, JSON.stringify(updatedList, null, 2), "utf-8");
      return api.sendMessage(
        "ğŸ¥± à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡ à¦à¦–à¦¨ à¦¬à¦¨à§à¦§! à¦•à§‡à¦‰ à¦—à¦¾à¦²à¦¿ à¦ªà¦¾à¦¬à§‡ à¦¨à¦¾à¥¤",
        threadID,
        messageID
      );
    }

    if (command === "on") {
      if (!mentions || Object.keys(mentions).length === 0) {
        return api.sendMessage(
          "ğŸ¤“ à¦•à¦¾à¦°à§‹ à¦¨à¦¾à¦® à¦Ÿà§à¦¯à¦¾à¦— à¦•à¦°à§‹ à¦¯à¦¾à¦•à§‡ à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡à§‡ à¦°à¦¾à¦–à¦¤à§‡ à¦šà¦¾à¦“à¥¤",
          threadID,
          messageID
        );
      }

      const mentionID = Object.keys(mentions)[0];

      const exists = kamlaList.some(
        e => e.threadID === threadID && e.userID === mentionID
      );

      if (exists) {
        return api.sendMessage(
          `ğŸ˜’ ${mentions[mentionID].replace("@", "")} à¦¤à§‹ à¦†à¦—à§‡à¦‡ à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡à§‡ à¦†à¦›à§‡!`,
          threadID,
          messageID
        );
      }

      kamlaList.push({ threadID, userID: mentionID });
      fs.writeFileSync(path, JSON.stringify(kamlaList, null, 2), "utf-8");

      return api.sendMessage(
        `ğŸ˜ˆ ${mentions[mentionID].replace("@", "")} à¦à¦–à¦¨ à¦¥à§‡à¦•à§‡ à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡à§‡! à¦•à¦¥à¦¾ à¦¬à¦²à¦²à§‡à¦‡ à¦—à¦¾à¦²à¦¿ à¦ªà¦¾à¦¬à§‡!`,
        threadID,
        messageID
      );
    }

    return api.sendMessage(
      `âš ï¸ Usage:\n.kamla on @user - à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡ à¦šà¦¾à¦²à§ à¦•à¦°à¦¬à§‡\n.kamla off - à¦•à¦¾à¦®à¦²à¦¾ à¦®à§‹à¦¡ à¦¬à¦¨à§à¦§ à¦•à¦°à¦¬à§‡`,
      threadID,
      messageID
    );
  },

  onChat: async function({ api, event }) {
    if (!event.isGroup) return;

    if (!fs.existsSync(path)) return;

    let kamlaList;
    try {
      kamlaList = JSON.parse(fs.readFileSync(path, "utf-8"));
    } catch {
      kamlaList = [];
    }

    const isKamla = kamlaList.some(
      e => e.threadID === event.threadID && e.userID === event.senderID
    );

    if (!isKamla) return;

    const insults = [
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦•à¦¾à¦®à¦²à¦¾, à¦—à§à¦—à¦²à§‡ à¦¨à¦¾à¦® à¦¸à¦¾à¦°à§à¦š à¦¦à¦¿à¦²à§‡ 'à¦§à¦¿à¦•à§à¦•à¦¾à¦°' à¦†à¦¸à§‡ ğŸ¤¡",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦…à¦ªà¦¦à¦¾à¦°à§à¦¥, WiFi à¦¤à§‹à¦°à§‡ à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿ à¦¹à¦¤à§‡ à¦²à¦œà§à¦œà¦¾ à¦ªà¦¾à¦¯à¦¼ ğŸ“¶ğŸš«",
      "à¦¤à§à¦‡ à¦—à¦°à§à¦­à¦ªà¦¾à¦¤ à¦®à¦¿à¦¸ à¦¹à¦¯à¦¼à§‡ à¦¯à¦¾à¦“à¦¯à¦¼à¦¾ à¦à¦•à¦Ÿà¦¾ à¦¬à§à¦¯à¦°à§à¦¥à¦¤à¦¾ ğŸ˜µ",
      "à¦¤à§à¦‡ à¦®à¦¾à¦¨à§à¦· à¦¨à¦¾, à¦…à¦ªà¦¶à¦¨à¦¾à¦² à¦­à§à¦²! âŒ",
      "à¦¤à§‹à¦° IQ à¦¦à§‡à¦–à¦²à§‡ à¦šà¦¾à§Ÿà§‡à¦° à¦•à¦¾à¦ªà§‡ à¦¬à§à¦¦à¦¬à§à¦¦à¦“ à¦¹à¦¾à¦¸à§‡ â˜•ğŸ˜‚",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦¬à¦¾à¦œà§‡, à¦ªà¦¿à¦à¦ªà¦¡à¦¼à¦¾à¦“ à¦¤à§‹à¦•à§‡ à¦–à§‡à¦¤à§‡ à¦šà¦¾à§Ÿ à¦¨à¦¾ ğŸœğŸ¤®",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦—à¦°à§€à¦¬ à¦®à¦—à¦œà§‡à¦° à¦®à¦¾à¦²à¦¿à¦•, à¦šà§à¦²à¦•à¦¾à¦¨à§‹à¦° à¦•à§à¦·à¦®à¦¤à¦¾à¦“ à¦¨à¦¾à¦‡ ğŸ§ ğŸš«",
      "à¦¤à§‹à¦°à§‡ à¦¦à§‡à¦‡à¦–à§à¦¯à¦¾ depression increase à¦¹à¦¯à¦¼ ğŸ“‰ğŸ« ",
      "à¦¤à§à¦‡ à¦œà¦¨à§à¦®à§‡à¦›à¦¿à¦¸ à¦­à§à¦² à¦•à¦°à§‡, à¦®à¦°à¦¤à§‡à¦“ à¦­à§à¦² à¦•à¦°à¦¬à¦¿ ğŸ¤¬",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦à¦•à§à¦¸à¦Ÿà§à¦°à¦¾, à¦¡à¦¿à¦°à§‡à¦•à§à¦Ÿà¦° à¦¤à§‹à¦•à§‡ à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ à¦¥à§‡à¦•à§‡ à¦•à§‡à¦Ÿà§‡ à¦«à§‡à¦²à§‡à¦›à§‡ ğŸ¬âŒ",
      "à¦¤à§‹à¦°à§‡ à¦…à¦ªà¦®à¦¾à¦¨ à¦•à¦°à¦¤à§‡ à¦—à¦¿à§Ÿà§‡à¦“ à¦…à¦ªà¦®à¦¾à¦¨ à¦¨à¦¿à¦œà§‡à¦°à§‡ à¦¬à§‡à¦‡à¦œà§à¦œà¦¤à¦¿ à¦®à¦¨à§‡ à¦•à¦°à§‡ ğŸ˜’",
      "à¦¤à§à¦‡ à¦¤à§‡à¦² à¦›à¦¾à¦¡à¦¼à¦¾ à¦­à¦¾à¦œà¦¾, à¦•à¦¿à¦›à§à¦° à¦¦à¦¾à¦® à¦¨à¦¾à¦‡ ğŸ³ğŸ¤¢",
      "à¦¤à§à¦‡ à¦ªà¦šà¦¾ à¦à¦®à¦¨ à¦¯à§‡ à¦¤à§‹à¦° à¦‰à¦ªà¦° à¦œà¦®à§‡ à¦¥à¦¾à¦•à¦¾ à¦§à§à¦²à¦¾à¦“ à¦¤à§‹à¦•à§‡ à¦›à§‡à¦¡à¦¼à§‡ à¦¯à¦¾à¦¯à¦¼ ğŸ§¹ğŸ«¥",
      "à¦¤à§à¦‡ à¦«à¦¾à¦à¦•à¦¾ à¦•à¦²à¦¸à¦¿, à¦¶à¦¬à§à¦¦ à¦›à¦¾à¦¡à¦¼à¦¾ à¦†à¦° à¦•à¦¿à¦›à§ à¦¨à¦¾à¦‡ ğŸ””",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦•à¦¾à¦®à¦²à¦¾, à¦­à§‚à¦¤à¦“ à¦¤à§‹à¦•à§‡ à¦¬à¦¾à¦à¦šà¦¾à§Ÿ à¦¨à¦¾ ğŸ‘»",
      "à¦¤à§à¦‡ à¦œà¦¨à§à¦®à§‡ à¦ªà¦¾à¦ª à¦•à¦°à¦›à¦¿à¦¸, à¦¬à§‡à¦à¦šà§‡ à¦¥à¦¾à¦•à¦¾à¦¯à¦¼ à¦¸à¦®à¦¾à¦œ à¦ªà¦šà¦›à§‡ â˜ ï¸",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦¬à¦¾à¦œà§‡, à¦¤à§‹à¦° à¦›à¦¾à¦¯à¦¼à¦¾à¦“ à¦¤à§‹à¦•à§‡ à¦à¦¡à¦¼à¦¾à¦¯à¦¼ ğŸ«£",
      "à¦¤à§à¦‡ à¦œà¦¨à§à¦®à¦¾à¦¨à§‹à¦° à¦¸à¦®à¦¯à¦¼ à¦­à§à¦² à¦•à¦°à§‡ à¦†à¦¸à¦®à¦¾à¦¨ à¦¥à¦¾à¦‡à¦•à¦¾ à¦ªà¦¡à¦¼à§‡ à¦—à§‡à¦›à¦¿à¦¸ ğŸš€â†˜ï¸",
      "à¦¤à§à¦‡ à¦«à¦°à¦®à¦¾à¦²à¦¿à¦¨ à¦›à¦¾à¦¡à¦¼à¦¾ à¦ªà¦à¦šà¦¾ ğŸ¤®",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦•à¦¾à¦®à¦²à¦¾, à¦¡à¦¾à¦•à§à¦¤à¦¾à¦° à¦¤à§‹à¦•à§‡ à¦¦à§‡à¦–à§‡ à¦¹à¦¾à¦¤ à¦§à§à¦¯à¦¼à§‡ à¦«à§‡à¦²à¦›à§‡ ğŸ§¼ğŸ©º",
      "à¦¤à§‹à¦° à¦®à§à¦–à§‡ à¦¥à§à¦¤à§ à¦¦à¦¿à¦²à§‡à¦“ à¦ªà¦¾à¦¨à¦¿ à¦…à¦ªà¦®à¦¾à¦¨à¦¿à¦¤ à¦¬à§‹à¦§ à¦•à¦°à§‡ ğŸ’¦ğŸ˜·",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦²à§‡à¦­à§‡à¦²à§‡à¦° à¦ªà¦à¦šà¦¾, à¦¤à§‹à¦°à§‡ à¦§à¦°à¦²à§‡ Dettol-à¦“ à¦•à¦¾à¦œ à¦•à¦°à§‡ à¦¨à¦¾ ğŸ§´âŒ",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦¬à§à¦¯à¦°à§à¦¥à¦¤à¦¾, à¦¤à§‹à¦•à§‡ à¦¦à§‡à¦–à¦²à§‡ à¦—à¦°à§à¦­à¦‡ à¦²à¦œà§à¦œà¦¾ à¦ªà¦¾à¦¯à¦¼ ğŸ¤°ğŸ˜“",
      "à¦¤à§‹à¦° à¦®à¦¤à§‹ à¦…à¦ªà¦¦à¦¾à¦°à§à¦¥ à¦¦à§à¦¨à¦¿à¦¯à¦¼à¦¾à¦¯à¦¼ à¦à¦•à¦Ÿà¦¾à¦‡ à¦•à¦ªà¦¿, à¦¸à§‡à¦Ÿà¦¾à¦“ à¦­à¦¾à¦™à¦¾ ğŸ“„ğŸ’”",
      "à¦¤à§à¦‡ à¦ªà¦à¦šà¦¾ à¦à¦®à¦¨, à¦®à¦°à¦¾à¦° à¦ªà¦°à§‡à¦“ à¦¤à§‹à¦•à§‡ à¦ªà¦šà¦¾ à¦¬à¦²à§‡ à¦˜à§‹à¦·à¦£à¦¾ à¦¦à§‡à¦¯à¦¼ ğŸ˜µâ€ğŸ’«",
      "à¦¤à§à¦‡ à¦à¦®à¦¨ à¦¨à§€à¦š, à¦¨à¦°à¦•à§‡à¦“ à¦¤à§‹à¦•à§‡ à¦ à¦¾à¦à¦‡ à¦¦à§‡à¦¯à¦¼ à¦¨à¦¾ ğŸ”¥ğŸ™…"
    ];

    const pick = () => insults[Math.floor(Math.random() * insults.length)];
    const insultMsg = `${pick()}\n${pick()}`;

    return api.sendMessage(insultMsg, event.threadID, event.messageID);
  }
};
